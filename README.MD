# DS2API

[![License](https://img.shields.io/github/license/CJackHwang/ds2api.svg)](LICENSE)
![Stars](https://img.shields.io/github/stars/CJackHwang/ds2api.svg)
![Forks](https://img.shields.io/github/forks/CJackHwang/ds2api.svg)
[![Version](https://img.shields.io/badge/version-1.6.11-blue.svg)](version.txt)
[![Docker](https://img.shields.io/badge/docker-ready-blue.svg)](DEPLOY.md)

è¯­è¨€ / Language: [ä¸­æ–‡](README.MD) | [English](README.en.md)

å°† DeepSeek Web å¯¹è¯èƒ½åŠ›è½¬æ¢ä¸º OpenAI ä¸ Claude å…¼å®¹ APIã€‚åç«¯ä¸º **Go å…¨é‡å®ç°**ï¼Œå‰ç«¯ä¸º React WebUI ç®¡ç†å°ï¼ˆæºç åœ¨ `webui/`ï¼Œéƒ¨ç½²æ—¶è‡ªåŠ¨æ„å»ºåˆ° `static/admin`ï¼‰ã€‚

## æ¶æ„æ¦‚è§ˆ

```mermaid
flowchart LR
    Client["ğŸ–¥ï¸ å®¢æˆ·ç«¯\n(OpenAI / Claude å…¼å®¹)"]

    subgraph DS2API["DS2API æœåŠ¡"]
        direction TB
        CORS["CORS ä¸­é—´ä»¶"]
        Auth["ğŸ” é‰´æƒä¸­é—´ä»¶"]

        subgraph Adapters["é€‚é…å™¨å±‚"]
            OA["OpenAI é€‚é…å™¨\n/v1/*"]
            CA["Claude é€‚é…å™¨\n/anthropic/*"]
        end

        subgraph Support["æ”¯æ’‘æ¨¡å—"]
            Pool["ğŸ“¦ è´¦å·æ±  / å¹¶å‘é˜Ÿåˆ—"]
            PoW["âš™ï¸ PoW WASM\n(wazero)"]
        end

        Admin["ğŸ› ï¸ Admin API\n/admin/*"]
        WebUI["ğŸŒ WebUI\n(/admin)"]
    end

    DS["â˜ï¸ DeepSeek API"]

    Client -- "è¯·æ±‚" --> CORS --> Auth
    Auth --> OA & CA
    OA & CA -- "è°ƒç”¨" --> DS
    Auth --> Admin
    OA & CA -. "è½®è¯¢é€‰è´¦å·" .-> Pool
    OA & CA -. "è®¡ç®— PoW" .-> PoW
    DS -- "å“åº”" --> Client
```

- **åç«¯**ï¼šGoï¼ˆ`cmd/ds2api/`ã€`api/`ã€`internal/`ï¼‰ï¼Œä¸ä¾èµ– Python è¿è¡Œæ—¶
- **å‰ç«¯**ï¼šReact ç®¡ç†å°ï¼ˆ`webui/`ï¼‰ï¼Œè¿è¡Œæ—¶æ‰˜ç®¡é™æ€æ„å»ºäº§ç‰©
- **éƒ¨ç½²**ï¼šæœ¬åœ°è¿è¡Œã€Dockerã€Vercel Serverlessã€Linux systemd

## æ ¸å¿ƒèƒ½åŠ›

| èƒ½åŠ› | è¯´æ˜ |
| --- | --- |
| OpenAI å…¼å®¹ | `GET /v1/models`ã€`GET /v1/models/{id}`ã€`POST /v1/chat/completions`ã€`POST /v1/responses`ã€`GET /v1/responses/{response_id}`ã€`POST /v1/embeddings` |
| Claude å…¼å®¹ | `GET /anthropic/v1/models`ã€`POST /anthropic/v1/messages`ã€`POST /anthropic/v1/messages/count_tokens` |
| å¤šè´¦å·è½®è¯¢ | è‡ªåŠ¨ token åˆ·æ–°ã€é‚®ç®±/æ‰‹æœºå·åŒç™»å½•æ–¹å¼ |
| å¹¶å‘é˜Ÿåˆ—æ§åˆ¶ | æ¯è´¦å· in-flight ä¸Šé™ + ç­‰å¾…é˜Ÿåˆ—ï¼ŒåŠ¨æ€è®¡ç®—å»ºè®®å¹¶å‘å€¼ |
| DeepSeek PoW | WASM è®¡ç®—ï¼ˆ`wazero`ï¼‰ï¼Œæ— éœ€å¤–éƒ¨ Node.js ä¾èµ– |
| Tool Calling | é˜²æ³„æ¼å¤„ç†ï¼šéä»£ç å—é«˜ç½®ä¿¡ç‰¹å¾è¯†åˆ«ã€`delta.tool_calls` æ—©å‘ã€ç»“æ„åŒ–å¢é‡è¾“å‡º |
| Admin API | é…ç½®ç®¡ç†ã€è´¦å·æµ‹è¯• / æ‰¹é‡æµ‹è¯•ã€å¯¼å…¥å¯¼å‡ºã€Vercel åŒæ­¥ |
| WebUI ç®¡ç†å° | `/admin` å•é¡µåº”ç”¨ï¼ˆä¸­è‹±æ–‡åŒè¯­ã€æ·±è‰²æ¨¡å¼ï¼‰ |
| è¿ç»´æ¢é’ˆ | `GET /healthz`ï¼ˆå­˜æ´»ï¼‰ã€`GET /readyz`ï¼ˆå°±ç»ªï¼‰ |

## å¹³å°å…¼å®¹çŸ©é˜µ

| çº§åˆ« | å¹³å° | å½“å‰çŠ¶æ€ |
| --- | --- | --- |
| P0 | Codex CLI/SDKï¼ˆ`wire_api=chat` / `wire_api=responses`ï¼‰ | âœ… |
| P0 | OpenAI SDKï¼ˆJS/Pythonï¼Œchat + responsesï¼‰ | âœ… |
| P0 | Vercel AI SDKï¼ˆopenai-compatibleï¼‰ | âœ… |
| P0 | Anthropic SDKï¼ˆmessagesï¼‰ | âœ… |
| P1 | LangChain / LlamaIndex / OpenWebUIï¼ˆOpenAI å…¼å®¹æ¥å…¥ï¼‰ | âœ… |
| P2 | MCP ç‹¬ç«‹æ¡¥æ¥å±‚ | è§„åˆ’ä¸­ |

## æ¨¡å‹æ”¯æŒ

### OpenAI æ¥å£

| æ¨¡å‹ | thinking | search |
| --- | --- | --- |
| `deepseek-chat` | âŒ | âŒ |
| `deepseek-reasoner` | âœ… | âŒ |
| `deepseek-chat-search` | âŒ | âœ… |
| `deepseek-reasoner-search` | âœ… | âœ… |

### Claude æ¥å£

| æ¨¡å‹ | é»˜è®¤æ˜ å°„ |
| --- | --- |
| `claude-sonnet-4-5` | `deepseek-chat` |
| `claude-haiku-4-5`ï¼ˆå…¼å®¹ `claude-3-5-haiku-latest`ï¼‰ | `deepseek-chat` |
| `claude-opus-4-6` | `deepseek-reasoner` |

å¯é€šè¿‡é…ç½®ä¸­çš„ `claude_mapping` æˆ– `claude_model_mapping` è¦†ç›–æ˜ å°„å…³ç³»ã€‚
å¦å¤–ï¼Œ`/anthropic/v1/models` ç°å·²åŒ…å« Claude 1.x/2.x/3.x/4.x å†å²æ¨¡å‹ ID ä¸å¸¸è§åˆ«åï¼Œä¾¿äºæ—§å®¢æˆ·ç«¯ç›´æ¥å…¼å®¹ã€‚

## å¿«é€Ÿå¼€å§‹

### é€šç”¨ç¬¬ä¸€æ­¥ï¼ˆæ‰€æœ‰éƒ¨ç½²æ–¹å¼ï¼‰

æŠŠ `config.json` ä½œä¸ºå”¯ä¸€é…ç½®æºï¼ˆæ¨èåšæ³•ï¼‰ï¼š

```bash
cp config.example.json config.json
# ç¼–è¾‘ config.json
```

åç»­éƒ¨ç½²å»ºè®®ï¼š
- æœ¬åœ°è¿è¡Œï¼šç›´æ¥è¯»å– `config.json`
- Docker / Vercelï¼šç”± `config.json` ç”Ÿæˆ `DS2API_CONFIG_JSON`ï¼ˆBase64ï¼‰æ³¨å…¥ç¯å¢ƒå˜é‡

### æ–¹å¼ä¸€ï¼šæœ¬åœ°è¿è¡Œ

**å‰ç½®è¦æ±‚**ï¼šGo 1.24+ï¼ŒNode.js 20+ï¼ˆä»…åœ¨éœ€è¦æ„å»º WebUI æ—¶ï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/CJackHwang/ds2api.git
cd ds2api

# 2. é…ç½®
cp config.example.json config.json
# ç¼–è¾‘ config.jsonï¼Œå¡«å…¥ä½ çš„ DeepSeek è´¦å·ä¿¡æ¯å’Œ API key

# 3. å¯åŠ¨
go run ./cmd/ds2api
```

é»˜è®¤ç›‘å¬åœ°å€ï¼š`http://localhost:5001`

> **WebUI è‡ªåŠ¨æ„å»º**ï¼šæœ¬åœ°é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œè‹¥ `static/admin` ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨å°è¯•æ‰§è¡Œ `npm install && npm run build`ï¼ˆéœ€è¦æœ¬æœºæœ‰ Node.jsï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ„å»ºï¼š`./scripts/build-webui.sh`

### æ–¹å¼äºŒï¼šDocker è¿è¡Œ

```bash
# 1. å‡†å¤‡ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# 2. ä» config.json ç”Ÿæˆ DS2API_CONFIG_JSONï¼ˆå•è¡Œ Base64ï¼‰
DS2API_CONFIG_JSON="$(base64 < config.json | tr -d '\n')"

# 3. ç¼–è¾‘ .envï¼Œè®¾ç½®ï¼š
#    DS2API_ADMIN_KEY=è¯·æ›¿æ¢ä¸ºå¼ºå¯†ç 
#    DS2API_CONFIG_JSON=${DS2API_CONFIG_JSON}

# 4. å¯åŠ¨
docker-compose up -d

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

æ›´æ–°é•œåƒï¼š`docker-compose up -d --build`

### æ–¹å¼ä¸‰ï¼šVercel éƒ¨ç½²

1. Fork ä»“åº“åˆ°è‡ªå·±çš„ GitHub
2. åœ¨ Vercel ä¸Šå¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæœ€å°‘è®¾ç½® `DS2API_ADMIN_KEY`ï¼›æ¨èåŒæ—¶è®¾ç½® `DS2API_CONFIG_JSON`ï¼‰
4. éƒ¨ç½²

å»ºè®®å…ˆåœ¨ä»“åº“ç›®å½•å¤åˆ¶æ¨¡æ¿å¹¶å¡«å†™ï¼š

```bash
cp config.example.json config.json
# ç¼–è¾‘ config.json
```

æ¨èï¼šå…ˆæœ¬åœ°æŠŠ `config.json` è½¬æˆ Base64ï¼Œå†ç²˜è´´åˆ° `DS2API_CONFIG_JSON`ï¼Œé¿å… JSON æ ¼å¼é”™è¯¯ï¼š

```bash
base64 < config.json | tr -d '\n'
```

> **æµå¼è¯´æ˜**ï¼š`/v1/chat/completions` åœ¨ Vercel ä¸Šé»˜è®¤èµ° `api/chat-stream.js`ï¼ˆNode Runtimeï¼‰ä»¥ä¿è¯å®æ—¶ SSEã€‚é‰´æƒã€è´¦å·é€‰æ‹©ã€ä¼šè¯/PoW å‡†å¤‡ä»ç”± Go å†…éƒ¨ prepare æ¥å£å®Œæˆï¼›æµå¼å“åº”ï¼ˆå« `tools`ï¼‰åœ¨ Node ä¾§æ‰§è¡Œä¸ Go å¯¹é½çš„è¾“å‡ºç»„è£…ä¸é˜²æ³„æ¼å¤„ç†ã€‚

è¯¦ç»†éƒ¨ç½²è¯´æ˜è¯·å‚é˜… [éƒ¨ç½²æŒ‡å—](DEPLOY.md)ã€‚

### æ–¹å¼å››ï¼šä¸‹è½½ Release æ„å»ºåŒ…

æ¯æ¬¡å‘å¸ƒ Release æ—¶ï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ„å»ºå¤šå¹³å°äºŒè¿›åˆ¶åŒ…ï¼š

```bash
# ä¸‹è½½å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…å
tar -xzf ds2api_v1.7.0_linux_amd64.tar.gz
cd ds2api_v1.7.0_linux_amd64
cp config.example.json config.json
# ç¼–è¾‘ config.json
./ds2api
```

### æ–¹å¼äº”ï¼šOpenCode CLI æ¥å…¥

1. å¤åˆ¶ç¤ºä¾‹é…ç½®ï¼š

```bash
cp opencode.json.example opencode.json
```

2. ç¼–è¾‘ `opencode.json`ï¼š
- å°† `baseURL` æ”¹ä¸ºä½ çš„ DS2API åœ°å€ï¼ˆä¾‹å¦‚ `https://your-domain.com/v1`ï¼‰
- å°† `apiKey` æ”¹ä¸ºä½ çš„ DS2API keyï¼ˆå¯¹åº” `config.keys`ï¼‰

3. åœ¨é¡¹ç›®ç›®å½•å¯åŠ¨ OpenCode CLIï¼ˆæŒ‰ä½ çš„å®‰è£…æ–¹å¼è¿è¡Œ `opencode`ï¼‰ã€‚

> å»ºè®®ä¼˜å…ˆä½¿ç”¨ OpenAI å…¼å®¹è·¯å¾„ï¼ˆ`/v1/*`ï¼‰ï¼Œå³ç¤ºä¾‹é‡Œçš„ `@ai-sdk/openai-compatible` providerã€‚
> è‹¥å®¢æˆ·ç«¯æ”¯æŒ `wire_api`ï¼Œå¯åˆ†åˆ«æµ‹è¯• `responses` ä¸ `chat`ï¼ŒDS2API ä¸¤æ¡é“¾è·¯éƒ½å…¼å®¹ã€‚

## é…ç½®è¯´æ˜

### `config.json` ç¤ºä¾‹

```json
{
  "keys": ["your-api-key-1", "your-api-key-2"],
  "accounts": [
    {
      "email": "user@example.com",
      "password": "your-password",
      "token": ""
    },
    {
      "mobile": "12345678901",
      "password": "your-password",
      "token": ""
    }
  ],
  "model_aliases": {
    "gpt-4o": "deepseek-chat",
    "gpt-5-codex": "deepseek-reasoner",
    "o3": "deepseek-reasoner"
  },
  "compat": {
    "wide_input_strict_output": true
  },
  "toolcall": {
    "mode": "feature_match",
    "early_emit_confidence": "high"
  },
  "responses": {
    "store_ttl_seconds": 900
  },
  "embeddings": {
    "provider": "deterministic"
  },
  "claude_model_mapping": {
    "fast": "deepseek-chat",
    "slow": "deepseek-reasoner"
  }
}
```

- `keys`ï¼šAPI è®¿é—®å¯†é’¥åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡ `Authorization: Bearer <key>` é‰´æƒ
- `accounts`ï¼šDeepSeek è´¦å·åˆ—è¡¨ï¼Œæ”¯æŒ `email` æˆ– `mobile` ç™»å½•
- `token`ï¼šç•™ç©ºåˆ™é¦–æ¬¡è¯·æ±‚æ—¶è‡ªåŠ¨ç™»å½•è·å–ï¼›ä¹Ÿå¯é¢„å¡«å·²æœ‰ token
- `model_aliases`ï¼šå¸¸è§æ¨¡å‹åï¼ˆå¦‚ GPT/Codex/Claudeï¼‰åˆ° DeepSeek æ¨¡å‹çš„æ˜ å°„
- `compat.wide_input_strict_output`ï¼šå»ºè®®ä¿æŒ `true`ï¼ˆå½“å‰å®ç°é»˜è®¤å®½è¿›ä¸¥å‡ºï¼‰
- `toolcall`ï¼šå›ºå®šé‡‡ç”¨ç‰¹å¾åŒ¹é… + é«˜ç½®ä¿¡æ—©å‘ç­–ç•¥
- `responses.store_ttl_seconds`ï¼š`/v1/responses/{id}` çš„å†…å­˜ç¼“å­˜ TTL
- `embeddings.provider`ï¼šembedding æä¾›æ–¹ï¼ˆå½“å‰å†…ç½® `deterministic/mock/builtin`ï¼‰
- `claude_model_mapping`ï¼šå­—å…¸ä¸­ `fast`/`slow` åç¼€æ˜ å°„åˆ°å¯¹åº” DeepSeek æ¨¡å‹

### ç¯å¢ƒå˜é‡

| å˜é‡ | ç”¨é€” | é»˜è®¤å€¼ |
| --- | --- | --- |
| `PORT` | æœåŠ¡ç«¯å£ | `5001` |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | `INFO`ï¼ˆå¯é€‰ï¼š`DEBUG`/`WARN`/`ERROR`ï¼‰ |
| `DS2API_ADMIN_KEY` | Admin ç™»å½•å¯†é’¥ | `admin` |
| `DS2API_JWT_SECRET` | Admin JWT ç­¾åå¯†é’¥ | ç­‰åŒ `DS2API_ADMIN_KEY` |
| `DS2API_JWT_EXPIRE_HOURS` | Admin JWT è¿‡æœŸå°æ—¶æ•° | `24` |
| `DS2API_CONFIG_PATH` | é…ç½®æ–‡ä»¶è·¯å¾„ | `config.json` |
| `DS2API_CONFIG_JSON` | ç›´æ¥æ³¨å…¥é…ç½®ï¼ˆJSON æˆ– Base64ï¼‰ | â€” |
| `DS2API_WASM_PATH` | PoW WASM æ–‡ä»¶è·¯å¾„ | è‡ªåŠ¨æŸ¥æ‰¾ |
| `DS2API_STATIC_ADMIN_DIR` | ç®¡ç†å°é™æ€æ–‡ä»¶ç›®å½• | `static/admin` |
| `DS2API_AUTO_BUILD_WEBUI` | å¯åŠ¨æ—¶è‡ªåŠ¨æ„å»º WebUI | æœ¬åœ°å¼€å¯ï¼ŒVercel å…³é—­ |
| `DS2API_ACCOUNT_MAX_INFLIGHT` | æ¯è´¦å·æœ€å¤§å¹¶å‘ in-flight è¯·æ±‚æ•° | `2` |
| `DS2API_ACCOUNT_CONCURRENCY` | åŒä¸Šï¼ˆå…¼å®¹æ—§åï¼‰ | â€” |
| `DS2API_ACCOUNT_MAX_QUEUE` | ç­‰å¾…é˜Ÿåˆ—ä¸Šé™ | `recommended_concurrency` |
| `DS2API_ACCOUNT_QUEUE_SIZE` | åŒä¸Šï¼ˆå…¼å®¹æ—§åï¼‰ | â€” |
| `DS2API_VERCEL_INTERNAL_SECRET` | Vercel æ··åˆæµå¼å†…éƒ¨é‰´æƒå¯†é’¥ | å›é€€ç”¨ `DS2API_ADMIN_KEY` |
| `DS2API_VERCEL_STREAM_LEASE_TTL_SECONDS` | æµå¼ lease è¿‡æœŸç§’æ•° | `900` |
| `VERCEL_TOKEN` | Vercel åŒæ­¥ token | â€” |
| `VERCEL_PROJECT_ID` | Vercel é¡¹ç›® ID | â€” |
| `VERCEL_TEAM_ID` | Vercel å›¢é˜Ÿ ID | â€” |
| `DS2API_VERCEL_PROTECTION_BYPASS` | Vercel éƒ¨ç½²ä¿æŠ¤ç»•è¿‡å¯†é’¥ï¼ˆå†…éƒ¨ Nodeâ†’Go è°ƒç”¨ï¼‰ | â€” |

## é‰´æƒæ¨¡å¼

è°ƒç”¨ä¸šåŠ¡æ¥å£ï¼ˆ`/v1/*`ã€`/anthropic/*`ï¼‰æ—¶æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

| æ¨¡å¼ | è¯´æ˜ |
| --- | --- |
| **æ‰˜ç®¡è´¦å·æ¨¡å¼** | `Bearer` æˆ– `x-api-key` ä¼ å…¥ `config.keys` ä¸­çš„ keyï¼Œç”±æœåŠ¡è‡ªåŠ¨è½®è¯¢é€‰æ‹©è´¦å· |
| **ç›´é€š token æ¨¡å¼** | ä¼ å…¥ token ä¸åœ¨ `config.keys` ä¸­æ—¶ï¼Œç›´æ¥ä½œä¸º DeepSeek token ä½¿ç”¨ |

å¯é€‰è¯·æ±‚å¤´ `X-Ds2-Target-Account`ï¼šæŒ‡å®šä½¿ç”¨æŸä¸ªæ‰˜ç®¡è´¦å·ï¼ˆå€¼ä¸º email æˆ– mobileï¼‰ã€‚

## å¹¶å‘æ¨¡å‹

```
æ¯è´¦å·å¯ç”¨å¹¶å‘ = DS2API_ACCOUNT_MAX_INFLIGHTï¼ˆé»˜è®¤ 2ï¼‰
å»ºè®®å¹¶å‘å€¼ = è´¦å·æ•°é‡ Ã— æ¯è´¦å·å¹¶å‘ä¸Šé™
ç­‰å¾…é˜Ÿåˆ—ä¸Šé™ = DS2API_ACCOUNT_MAX_QUEUEï¼ˆé»˜è®¤ = å»ºè®®å¹¶å‘å€¼ï¼‰
429 é˜ˆå€¼ = in-flight + ç­‰å¾…é˜Ÿåˆ— â‰ˆ è´¦å·æ•°é‡ Ã— 4
```

- å½“ in-flight æ§½ä½æ»¡æ—¶ï¼Œè¯·æ±‚è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œ**ä¸ä¼šç«‹å³ 429**
- è¶…å‡ºæ€»æ‰¿è½½ä¸Šé™åæ‰è¿”å› `429 Too Many Requests`
- `GET /admin/queue/status` è¿”å›å®æ—¶å¹¶å‘çŠ¶æ€

## Tool Call é€‚é…

å½“è¯·æ±‚ä¸­å¸¦ `tools` æ—¶ï¼ŒDS2API ä¼šåšé˜²æ³„æ¼å¤„ç†ï¼š

1. åªåœ¨**éä»£ç å—ä¸Šä¸‹æ–‡**å¯ç”¨ toolcall ç‰¹å¾è¯†åˆ«ï¼ˆä»£ç å—ç¤ºä¾‹ä¸ä¼šè§¦å‘ï¼‰
2. ä¸€æ—¦å‘½ä¸­é«˜ç½®ä¿¡ç‰¹å¾ï¼ˆ`tool_calls` + `name` + `arguments/input` èµ·å§‹ï¼‰å°±ç«‹å³è¾“å‡º `delta.tool_calls`
3. å·²ç¡®è®¤çš„ toolcall JSON ç‰‡æ®µä¸ä¼šæ³„æ¼åˆ° `delta.content`
4. å‰æ–‡/åæ–‡è‡ªç„¶è¯­è¨€ä¿æŒé¡ºåºé€ä¼ ï¼Œæ”¯æŒæ··åˆæ–‡æœ¬ä¸å¢é‡å‚æ•°è¾“å‡º

## é¡¹ç›®ç»“æ„

```text
ds2api/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ ds2api/              # æœ¬åœ° / å®¹å™¨å¯åŠ¨å…¥å£
â”‚   â””â”€â”€ ds2api-tests/        # ç«¯åˆ°ç«¯æµ‹è¯•é›†å…¥å£
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.go             # Vercel Serverless Go å…¥å£
â”‚   â”œâ”€â”€ chat-stream.js       # Vercel Node.js æµå¼è½¬å‘
â”‚   â””â”€â”€ helpers/             # Node.js è¾…åŠ©æ¨¡å—
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ account/             # è´¦å·æ± ä¸å¹¶å‘é˜Ÿåˆ—
â”‚   â”œâ”€â”€ adapter/
â”‚   â”‚   â”œâ”€â”€ openai/          # OpenAI å…¼å®¹é€‚é…å™¨ï¼ˆå« Tool Call è§£æã€Vercel æµå¼ prepare/releaseï¼‰
â”‚   â”‚   â””â”€â”€ claude/          # Claude å…¼å®¹é€‚é…å™¨
â”‚   â”œâ”€â”€ admin/               # Admin API handlers
â”‚   â”œâ”€â”€ auth/                # é‰´æƒä¸ JWT
â”‚   â”œâ”€â”€ config/              # é…ç½®åŠ è½½ä¸çƒ­æ›´æ–°
â”‚   â”œâ”€â”€ deepseek/            # DeepSeek API å®¢æˆ·ç«¯ã€PoW WASM
â”‚   â”œâ”€â”€ server/              # HTTP è·¯ç”±ä¸ä¸­é—´ä»¶ï¼ˆchi routerï¼‰
â”‚   â”œâ”€â”€ sse/                 # SSE è§£æå·¥å…·
â”‚   â”œâ”€â”€ util/                # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ webui/               # WebUI é™æ€æ–‡ä»¶æ‰˜ç®¡ä¸è‡ªåŠ¨æ„å»º
â”œâ”€â”€ webui/                   # React WebUI æºç ï¼ˆVite + Tailwindï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/      # AccountManager / ApiTester / BatchImport / VercelSync / Login / LandingPage
â”‚       â””â”€â”€ locales/         # ä¸­è‹±æ–‡è¯­è¨€åŒ…ï¼ˆzh.json / en.jsonï¼‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ build-webui.sh       # WebUI æ‰‹åŠ¨æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ testsuite/           # æµ‹è¯•é›†è¿è¡Œè„šæœ¬
â”œâ”€â”€ static/admin/            # WebUI æ„å»ºäº§ç‰©ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/           # GitHub Actionsï¼ˆRelease è‡ªåŠ¨æ„å»ºï¼‰
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/      # Issue æ¨¡æ¿
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md
â”œâ”€â”€ config.example.json      # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ Dockerfile               # å¤šé˜¶æ®µæ„å»ºï¼ˆWebUI + Goï¼‰
â”œâ”€â”€ docker-compose.yml       # ç”Ÿäº§ç¯å¢ƒ Docker Compose
â”œâ”€â”€ docker-compose.dev.yml   # å¼€å‘ç¯å¢ƒ Docker Compose
â”œâ”€â”€ vercel.json              # Vercel è·¯ç”±ä¸æ„å»ºé…ç½®
â”œâ”€â”€ go.mod / go.sum          # Go æ¨¡å—ä¾èµ–
â””â”€â”€ version.txt              # ç‰ˆæœ¬å·
```

## æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è¯´æ˜ |
| --- | --- |
| [API.md](API.md) / [API.en.md](API.en.md) | API æ¥å£æ–‡æ¡£ï¼ˆå«è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼‰ |
| [DEPLOY.md](DEPLOY.md) / [DEPLOY.en.md](DEPLOY.en.md) | éƒ¨ç½²æŒ‡å—ï¼ˆæœ¬åœ°/Docker/Vercel/systemdï¼‰ |
| [CONTRIBUTING.md](CONTRIBUTING.md) / [CONTRIBUTING.en.md](CONTRIBUTING.en.md) | è´¡çŒ®æŒ‡å— |
| [TESTING.md](TESTING.md) | æµ‹è¯•é›†ä½¿ç”¨æŒ‡å— |

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test ./...

# ä¸€é”®ç«¯åˆ°ç«¯å…¨é“¾è·¯æµ‹è¯•ï¼ˆçœŸå®è´¦å·ï¼Œç”Ÿæˆå®Œæ•´è¯·æ±‚/å“åº”æ—¥å¿—ï¼‰
./scripts/testsuite/run-live.sh

# æˆ–è‡ªå®šä¹‰å‚æ•°
go run ./cmd/ds2api-tests \
  --config config.json \
  --admin-key admin \
  --out artifacts/testsuite \
  --timeout 120 \
  --retries 2
```

## Release è‡ªåŠ¨æ„å»ºï¼ˆGitHub Actionsï¼‰

å·¥ä½œæµæ–‡ä»¶ï¼š`.github/workflows/release-artifacts.yml`

- **è§¦å‘æ¡ä»¶**ï¼šä»…åœ¨ GitHub Release `published` æ—¶è§¦å‘ï¼ˆæ™®é€š push ä¸ä¼šè§¦å‘ï¼‰
- **æ„å»ºäº§ç‰©**ï¼šå¤šå¹³å°äºŒè¿›åˆ¶åŒ…ï¼ˆ`linux/amd64`ã€`linux/arm64`ã€`darwin/amd64`ã€`darwin/arm64`ã€`windows/amd64`ï¼‰+ `sha256sums.txt`
- **æ¯ä¸ªå‹ç¼©åŒ…åŒ…å«**ï¼š`ds2api` å¯æ‰§è¡Œæ–‡ä»¶ã€`static/admin`ã€WASM æ–‡ä»¶ã€é…ç½®ç¤ºä¾‹ã€READMEã€LICENSE

## å…è´£å£°æ˜

æœ¬é¡¹ç›®åŸºäºé€†å‘æ–¹å¼å®ç°ï¼Œä»…ä¾›å­¦ä¹ ä¸ç ”ç©¶ä½¿ç”¨ã€‚ç¨³å®šæ€§å’Œå¯ç”¨æ€§ä¸ä½œä¿è¯ï¼Œè¯·å‹¿ç”¨äºè¿åæœåŠ¡æ¡æ¬¾æˆ–æ³•å¾‹æ³•è§„çš„åœºæ™¯ã€‚
